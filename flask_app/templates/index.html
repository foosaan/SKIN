<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíé Skin Tone AI Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        @keyframes gradient-shift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
            }

            50% {
                box-shadow: 0 0 40px rgba(139, 92, 246, 0.7);
            }
        }

        .gradient-text {
            background: linear-gradient(90deg, #c4b5fd, #f9a8d4, #fcd34d, #c4b5fd);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-shift 3s ease infinite;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .glow-border {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6366f1, #8b5cf6);
            border-radius: 4px;
        }

        .drop-zone.dragover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top-color: #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .conf-high {
            background: linear-gradient(90deg, #22c55e, #16a34a);
        }

        .conf-medium {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .conf-low {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .tab-active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .tab-inactive {
            background: rgba(51, 65, 85, 0.5);
            color: #94a3b8;
        }

        .tab-inactive:hover {
            background: rgba(99, 102, 241, 0.2);
            color: #c4b5fd;
        }

        /* ===== RESPONSIVE STYLES ===== */

        /* Container responsif */
        .responsive-container {
            width: 100%;
            max-width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        /* Mobile First - Default mobile styles */
        @media (max-width: 640px) {
            .main-header h1 {
                font-size: 1.75rem !important;
            }

            .glass-card {
                padding: 1rem;
                border-radius: 1rem;
            }

            /* Color swatches lebih kecil di mobile */
            #skinColorSwatch,
            #clothingColorSwatch {
                width: 4rem !important;
                height: 4rem !important;
            }

            /* Stack comparison vertically on mobile */
            .color-comparison-swatches {
                flex-direction: column !important;
                gap: 1rem !important;
            }

            /* Preview skin+clothing stack */
            .preview-strip {
                flex-direction: column !important;
                height: auto !important;
            }

            .preview-strip>div {
                height: 3rem !important;
            }

            /* Smaller text on mobile */
            .mobile-text-sm {
                font-size: 0.75rem !important;
            }

            /* Full width buttons */
            button {
                width: 100%;
            }

            /* Color palette grid - 4 columns on mobile */
            #goodColorPalette,
            #avoidColorPalette {
                grid-template-columns: repeat(4, 1fr) !important;
            }
        }

        /* Tablet */
        @media (min-width: 641px) and (max-width: 1024px) {
            .responsive-container {
                max-width: 90%;
                margin: 0 auto;
            }

            #skinColorSwatch,
            #clothingColorSwatch {
                width: 5rem !important;
                height: 5rem !important;
            }
        }

        /* Desktop */
        @media (min-width: 1025px) {
            .responsive-container {
                max-width: 1200px;
                margin: 0 auto;
            }
        }

        /* Large Desktop */
        @media (min-width: 1440px) {
            .responsive-container {
                max-width: 1400px;
            }

            #skinColorSwatch,
            #clothingColorSwatch {
                width: 7rem !important;
                height: 7rem !important;
            }
        }

        /* Fluid typography */
        html {
            font-size: clamp(14px, 1.5vw, 16px);
        }

        /* Flexible grid untuk color comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Auto-scaling aspect ratio */
        .aspect-video {
            aspect-ratio: 16 / 9;
        }

        @media (max-width: 640px) {
            .aspect-video {
                aspect-ratio: 4 / 3;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-950 via-purple-950 to-slate-950">
    <!-- HERO SECTION -->
    <header class="relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-900/30 via-pink-900/20 to-purple-900/30"></div>
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl"></div>

        <div class="relative z-10 w-full max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12 text-center">
            <div class="float-animation inline-block mb-4">
                <span class="text-5xl">üíé</span>
            </div>
            <h1 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold gradient-text mb-3">
                Skin Tone AI Professional
            </h1>
            <p class="text-sm sm:text-base lg:text-lg text-purple-200/80 mb-6">
                Sistem Rekomendasi Warna Pakaian dengan Kecerdasan Buatan
            </p>
            <div class="flex flex-wrap justify-center gap-2">
                <span
                    class="px-3 py-1.5 rounded-full bg-green-500/20 text-green-300 border border-green-500/50 text-xs font-medium">‚úÖ
                    YOLO Face</span>
                <span
                    class="px-3 py-1.5 rounded-full bg-blue-500/20 text-blue-300 border border-blue-500/50 text-xs font-medium">‚úÖ
                    AI Analysis</span>
                <span
                    class="px-3 py-1.5 rounded-full bg-orange-500/20 text-orange-300 border border-orange-500/50 text-xs font-medium">‚úÖ
                    Smart Rec</span>
            </div>
        </div>
    </header>

    <!-- TAB NAVIGATION -->
    <div class="w-full max-w-4xl mx-auto px-4 sm:px-6 -mt-4">
        <div class="flex rounded-2xl overflow-hidden shadow-lg">
            <button id="tabWebcam" onclick="switchTab('webcam')"
                class="flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-active">
                <span class="text-xl">üì∑</span> Webcam
            </button>
            <button id="tabUpload" onclick="switchTab('upload')"
                class="flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-inactive">
                <span class="text-xl">üìÅ</span> Upload Gambar
            </button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="w-full max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-8">

        <!-- ============ WEBCAM VIEW ============ -->
        <div id="viewWebcam" class="space-y-6">
            <div class="glass-card rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8 glow-border">
                <div class="flex items-center gap-3 mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-3xl shadow-lg">
                        üì∑
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Real-Time Detection</h2>
                        <p class="text-purple-300/70">Analisis wajah langsung dari webcam</p>
                    </div>
                </div>

                <!-- Webcam Preview -->
                <div
                    class="relative aspect-video bg-slate-900/80 rounded-2xl overflow-hidden mb-6 border border-purple-500/20">
                    <video id="webcam" autoplay playsinline class="w-full h-full object-cover hidden"></video>
                    <canvas id="webcamCanvas" class="w-full h-full object-cover hidden"></canvas>
                    <div id="webcamPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center">
                        <div class="w-24 h-24 rounded-full bg-purple-500/10 flex items-center justify-center mb-4">
                            <span class="text-5xl">üé•</span>
                        </div>
                        <p class="text-purple-300/70 text-lg">Webcam belum aktif</p>
                        <p class="text-purple-300/50 text-sm mt-1">Klik tombol di bawah untuk memulai</p>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex gap-4">
                    <button id="startWebcam"
                        class="flex-1 py-4 px-6 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold text-lg hover:from-purple-500 hover:to-pink-500 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-purple-500/30">
                        üé• Aktifkan Webcam
                    </button>
                    <button id="captureBtn"
                        class="py-4 px-8 rounded-2xl bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold text-lg hover:from-green-500 hover:to-emerald-500 transition-all shadow-lg shadow-green-500/30 disabled:opacity-40 disabled:cursor-not-allowed disabled:shadow-none"
                        disabled>
                        üì∏ Capture
                    </button>
                </div>

                <!-- Tips -->
                <div class="mt-6 p-4 rounded-xl bg-blue-500/10 border border-blue-500/30">
                    <p class="text-blue-300 text-sm">
                        üí° <strong>Tips:</strong> Pastikan wajah terlihat jelas, pencahayaan cukup, dan berada 30-50cm
                        dari kamera.
                    </p>
                </div>
            </div>
        </div>

        <!-- ============ UPLOAD VIEW ============ -->
        <div id="viewUpload" class="space-y-6 hidden">
            <div class="glass-card rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8">
                <div class="flex items-center gap-3 mb-6">
                    <div
                        class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-3xl shadow-lg">
                        üìÅ
                    </div>
                    <div>
                        <h2 class="text-xl sm:text-2xl font-bold text-white">Upload Gambar</h2>
                        <p class="text-purple-300/70">Analisis foto wajah dari file</p>
                    </div>
                </div>

                <!-- Tips Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6">
                    <div class="p-4 rounded-xl bg-green-500/10 border border-green-500/30">
                        <h4 class="text-green-400 font-semibold mb-2">‚úÖ Gambar Bagus</h4>
                        <ul class="text-green-300/80 text-sm space-y-1">
                            <li>‚Ä¢ Wajah terlihat jelas</li>
                            <li>‚Ä¢ Pencahayaan merata</li>
                            <li>‚Ä¢ Resolusi tinggi</li>
                        </ul>
                    </div>
                    <div class="p-4 rounded-xl bg-red-500/10 border border-red-500/30">
                        <h4 class="text-red-400 font-semibold mb-2">üö´ Hindari</h4>
                        <ul class="text-red-300/80 text-sm space-y-1">
                            <li>‚Ä¢ Wajah tertutup</li>
                            <li>‚Ä¢ Terlalu gelap/terang</li>
                            <li>‚Ä¢ Gambar blur</li>
                        </ul>
                    </div>
                </div>

                <!-- Upload Zone -->
                <div id="dropZone"
                    class="drop-zone relative aspect-video bg-slate-900/80 rounded-2xl border-2 border-dashed border-purple-500/50 overflow-hidden mb-6 cursor-pointer hover:border-purple-400 transition-all group">
                    <input type="file" id="fileInput" accept="image/*"
                        class="absolute inset-0 opacity-0 cursor-pointer z-10">
                    <div id="uploadPlaceholder"
                        class="absolute inset-0 flex flex-col items-center justify-center transition-all group-hover:scale-105">
                        <div
                            class="w-20 h-20 rounded-full bg-purple-500/10 flex items-center justify-center mb-4 group-hover:bg-purple-500/20 transition-all">
                            <span class="text-4xl">üì§</span>
                        </div>
                        <p class="text-purple-300/70 text-lg">Drag & drop gambar di sini</p>
                        <p class="text-purple-300/50 text-sm mt-1">atau klik untuk memilih file</p>
                        <p class="text-purple-400/50 text-xs mt-3">JPG, PNG, HEIC ‚Ä¢ Max 10MB</p>
                    </div>
                    <img id="uploadPreview" class="w-full h-full object-contain hidden">
                </div>

                <!-- Analyze Button -->
                <button id="analyzeUpload"
                    class="w-full py-4 px-6 rounded-2xl bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold text-lg hover:from-blue-500 hover:to-cyan-500 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-blue-500/30 disabled:opacity-40 disabled:cursor-not-allowed disabled:shadow-none"
                    disabled>
                    üîç Analisis Gambar
                </button>
            </div>
        </div>

        <!-- ============ LOADING STATE ============ -->
        <div id="loadingState" class="hidden glass-card rounded-2xl sm:rounded-3xl p-8 sm:p-12 text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-purple-200 text-xl font-semibold">Menganalisis gambar...</p>
            <p class="text-purple-300/50 mt-2">AI sedang mendeteksi wajah dan menganalisis skin tone</p>
        </div>

        <!-- ============ RESULTS SECTION ============ -->
        <div id="resultsSection" class="hidden mt-6 sm:mt-8">
            <h2
                class="text-xl sm:text-2xl lg:text-3xl font-bold text-white mb-4 sm:mb-6 text-center flex items-center justify-center gap-2 sm:gap-3">
                <span class="text-2xl sm:text-3xl lg:text-4xl">üìä</span> Hasil Analisis
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                <!-- Annotated Image -->
                <div class="glass-card rounded-2xl sm:rounded-3xl p-4 sm:p-6">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                        <span>üéØ</span> Detection Result
                    </h3>
                    <img id="resultImage" class="w-full rounded-2xl shadow-lg" alt="Result">
                </div>

                <!-- Detection Details -->
                <div id="detectionDetails" class="space-y-4">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- ============ COLOR COMPARISON SECTION ============ -->
            <div id="colorComparisonSection" class="mt-6 sm:mt-8 glass-card rounded-2xl sm:rounded-3xl p-4 sm:p-6">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-lg sm:text-xl font-bold text-white flex items-center gap-2">
                            üé® Color Comparison
                        </h3>
                        <p class="text-purple-300/50 text-sm">Lihat bagaimana warna pakaian cocok dengan warna kulit
                            Anda</p>
                    </div>
                </div>

                <!-- Main Comparison Area -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
                    <!-- Left: Color Swatches Comparison -->
                    <div class="p-4 sm:p-6 rounded-xl sm:rounded-2xl bg-slate-800/50 border border-slate-700">
                        <p class="text-purple-300 text-sm font-semibold mb-4 text-center">üëÅÔ∏è Visual Comparison</p>

                        <!-- Side by Side Swatches -->
                        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6 mb-6">
                            <!-- Skin Color Swatch -->
                            <div class="text-center">
                                <div id="skinColorSwatch"
                                    class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-xl sm:rounded-2xl shadow-lg border-4 border-white/20 mx-auto mb-2 transition-all"
                                    style="background: #D4A574;"></div>
                                <p class="text-sm text-white font-medium">Kulit Anda</p>
                                <p id="skinColorHex" class="text-xs text-purple-300/70 font-mono">#D4A574</p>
                            </div>

                            <!-- VS Indicator -->
                            <div class="flex flex-col items-center">
                                <span class="text-2xl font-bold text-purple-400">VS</span>
                                <div id="harmonyIndicator"
                                    class="mt-2 px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-400 transition-all">
                                    ‚úì Harmonis
                                </div>
                            </div>

                            <!-- Clothing Color Swatch -->
                            <div class="text-center">
                                <div id="clothingColorSwatch"
                                    class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 rounded-xl sm:rounded-2xl shadow-lg border-4 border-white/20 mx-auto mb-2 transition-all"
                                    style="background: #50C878;"></div>
                                <p id="clothingColorName" class="text-sm text-white font-medium">Emerald</p>
                                <p id="clothingColorHex" class="text-xs text-purple-300/70 font-mono">#50C878</p>
                            </div>
                        </div>

                        <!-- Combined Preview (Skin + Clothing together) -->
                        <div class="p-4 rounded-xl bg-slate-900/50 border border-slate-600">
                            <p class="text-purple-300/70 text-xs text-center mb-3">Preview: Kulit + Pakaian</p>
                            <div class="flex justify-center items-stretch h-20 rounded-xl overflow-hidden shadow-inner">
                                <div id="previewSkin" class="flex-1 transition-all" style="background: #D4A574;"></div>
                                <div id="previewClothing" class="flex-1 transition-all" style="background: #50C878;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Metrics & Feedback -->
                    <div class="space-y-4">
                        <!-- Skin Effect Indicator -->
                        <div id="skinEffectCard"
                            class="p-5 rounded-2xl bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-500/30 transition-all">
                            <div class="flex items-center gap-3 mb-2">
                                <span id="skinEffectIcon" class="text-3xl">‚ú®</span>
                                <div>
                                    <p id="skinEffectTitle" class="text-lg font-bold text-green-300">Kulit Terlihat
                                        Cerah</p>
                                    <p id="skinEffectDesc" class="text-sm text-green-200/70">Warna ini menonjolkan
                                        kecerahan kulit Anda</p>
                                </div>
                            </div>
                        </div>

                        <!-- Contrast Score -->
                        <div class="p-4 rounded-xl bg-slate-800/50 border border-slate-700">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-white text-sm font-medium">üéØ Kontras</span>
                                <span id="contrastScore" class="text-lg font-bold text-purple-300">80%</span>
                            </div>
                            <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                                <div id="contrastBar"
                                    class="h-full rounded-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500"
                                    style="width: 80%;"></div>
                            </div>
                            <p id="contrastText" class="text-slate-400 text-xs mt-2">Kontras yang baik membuat warna
                                saling menonjol</p>
                        </div>

                        <!-- Harmony Score -->
                        <div class="p-4 rounded-xl bg-slate-800/50 border border-slate-700">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-white text-sm font-medium">üåà Harmoni Warna</span>
                                <span id="harmonyScore" class="text-lg font-bold text-purple-300">85%</span>
                            </div>
                            <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                                <div id="harmonyBar"
                                    class="h-full rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-500"
                                    style="width: 85%;"></div>
                            </div>
                            <p id="harmonyText" class="text-slate-400 text-xs mt-2">Warna yang harmonis menciptakan
                                kesan seimbang</p>
                        </div>

                        <!-- Overall Score -->
                        <div
                            class="p-4 rounded-xl bg-gradient-to-r from-purple-900/30 to-pink-900/30 border border-purple-500/30">
                            <div class="flex items-center justify-between">
                                <span class="text-white text-sm font-medium">‚≠ê Skor Kecocokan</span>
                                <div class="flex items-center gap-2">
                                    <span id="overallStars" class="text-yellow-400">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <span id="overallScore" class="text-xl font-bold text-white">85%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Color Palette Selection -->
                <div class="p-4 rounded-2xl bg-slate-800/50">
                    <p class="text-purple-300 text-sm font-semibold mb-4">üé® Pilih Warna untuk Dibandingkan</p>

                    <div class="grid md:grid-cols-2 gap-4">
                        <!-- Recommended Colors -->
                        <div>
                            <p class="text-green-400 text-xs font-medium mb-2">‚úÖ Direkomendasikan</p>
                            <div id="goodColorPalette" class="grid grid-cols-3 gap-2">
                                <!-- Filled by JS -->
                            </div>
                        </div>

                        <!-- Avoid Colors -->
                        <div>
                            <p class="text-red-400 text-xs font-medium mb-2">üö´ Hindari</p>
                            <div id="avoidColorPalette" class="grid grid-cols-3 gap-2">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Custom Color -->
                    <div class="mt-4 pt-4 border-t border-slate-700 flex items-center gap-4">
                        <input type="color" id="customColorPicker" value="#6366f1"
                            class="w-10 h-10 rounded-lg cursor-pointer border-2 border-purple-500/50"
                            onchange="applyCustomColor(this.value)">
                        <span class="text-purple-300/70 text-sm">Coba warna custom</span>
                    </div>
                </div>
            </div>

            <!-- Fullscreen Modal (simplified) -->
            <div id="fullscreenModal" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-8"
                onclick="closeFullscreen()">
                <button
                    class="absolute top-4 right-4 p-3 rounded-xl bg-white/10 hover:bg-white/20 text-white transition-all text-lg">
                    ‚úï
                </button>
                <div class="max-w-2xl w-full" onclick="event.stopPropagation()">
                    <canvas id="fullscreenCanvas" class="w-full rounded-2xl shadow-2xl"></canvas>
                    <p id="fullscreenLabel" class="text-center text-white mt-4 font-medium"></p>
                </div>
            </div>

            <!-- Analyze Another Button -->
            <div class="mt-8 text-center">
                <button onclick="resetAnalysis()"
                    class="py-3 px-8 rounded-xl bg-purple-500/20 text-purple-300 font-semibold hover:bg-purple-500/30 transition-all border border-purple-500/30">
                    üîÑ Analisis Gambar Lain
                </button>
            </div>
        </div>

        <!-- ============ NO FACE DETECTED ============ -->
        <div id="noFaceSection" class="hidden glass-card rounded-3xl p-12 text-center mt-8">
            <span class="text-6xl mb-4 block">üòï</span>
            <h3 class="text-2xl font-bold text-white mb-4">Wajah Tidak Terdeteksi</h3>
            <p class="text-purple-300/70 mb-6 max-w-md mx-auto">
                AI tidak dapat menemukan wajah. Coba tips berikut:
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 max-w-xl mx-auto text-sm">
                <div class="p-3 rounded-xl bg-purple-500/10 text-purple-300">‚úÖ Wajah jelas</div>
                <div class="p-3 rounded-xl bg-purple-500/10 text-purple-300">‚úÖ Cahaya cukup</div>
                <div class="p-3 rounded-xl bg-purple-500/10 text-purple-300">‚úÖ Tidak blur</div>
                <div class="p-3 rounded-xl bg-purple-500/10 text-purple-300">‚úÖ Frontal view</div>
            </div>
            <button onclick="resetAnalysis()"
                class="mt-6 py-3 px-8 rounded-xl bg-purple-600 text-white font-semibold hover:bg-purple-500 transition-all">
                üîÑ Coba Lagi
            </button>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="border-t border-purple-500/20 mt-12">
        <div class="max-w-6xl mx-auto px-6 py-6 text-center">
            <p class="text-purple-300/50 text-sm">
                üíé Skin Tone AI Professional ‚Äî Flask + TailwindCSS + YOLOv8 + TensorFlow
            </p>
        </div>
    </footer>

    <script>
        // ===== TAB SWITCHING =====
        function switchTab(tab) {
            const tabWebcam = document.getElementById('tabWebcam');
            const tabUpload = document.getElementById('tabUpload');
            const viewWebcam = document.getElementById('viewWebcam');
            const viewUpload = document.getElementById('viewUpload');

            // Reset results when switching tabs
            resetAnalysis();

            if (tab === 'webcam') {
                tabWebcam.className = 'flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-active';
                tabUpload.className = 'flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-inactive';
                viewWebcam.classList.remove('hidden');
                viewUpload.classList.add('hidden');
            } else {
                tabUpload.className = 'flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-active';
                tabWebcam.className = 'flex-1 py-4 px-6 font-semibold transition-all duration-300 flex items-center justify-center gap-2 tab-inactive';
                viewUpload.classList.remove('hidden');
                viewWebcam.classList.add('hidden');
            }
        }

        function resetAnalysis() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('noFaceSection').classList.add('hidden');
        }

        // ===== ELEMENTS =====
        const webcam = document.getElementById('webcam');
        const webcamCanvas = document.getElementById('webcamCanvas');
        const webcamPlaceholder = document.getElementById('webcamPlaceholder');
        const startWebcamBtn = document.getElementById('startWebcam');
        const captureBtn = document.getElementById('captureBtn');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadPreview = document.getElementById('uploadPreview');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const analyzeBtn = document.getElementById('analyzeUpload');

        let uploadedFile = null;

        // ===== WEBCAM =====
        startWebcamBtn.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 640, height: 480, facingMode: 'user' }
                });
                webcam.srcObject = stream;
                webcam.classList.remove('hidden');
                webcamPlaceholder.classList.add('hidden');
                captureBtn.disabled = false;
                startWebcamBtn.innerHTML = 'üîÑ Restart';
            } catch (err) {
                alert('Tidak dapat mengakses webcam: ' + err.message);
            }
        });

        captureBtn.addEventListener('click', () => {
            const ctx = webcamCanvas.getContext('2d');
            webcamCanvas.width = webcam.videoWidth;
            webcamCanvas.height = webcam.videoHeight;
            ctx.drawImage(webcam, 0, 0);
            const imageData = webcamCanvas.toDataURL('image/jpeg', 0.9);
            analyzeImage(imageData);
        });

        // ===== UPLOAD =====
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('dragover'); });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) handleFile(file);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            uploadedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                uploadPreview.src = e.target.result;
                uploadPreview.classList.remove('hidden');
                uploadPlaceholder.classList.add('hidden');
                analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        analyzeBtn.addEventListener('click', () => {
            if (uploadedFile) {
                const reader = new FileReader();
                reader.onload = (e) => analyzeImage(e.target.result);
                reader.readAsDataURL(uploadedFile);
            }
        });
        // ===== ANALYSIS =====
        async function analyzeImage(imageData) {
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('noFaceSection').classList.add('hidden');

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image_base64: imageData })
                });

                const data = await response.json();
                document.getElementById('loadingState').classList.add('hidden');

                // Check for too many faces error
                if (data.error && data.face_count > 2) {
                    showTooManyFacesError(data.message, data.face_count);
                    return;
                }

                if (data.success && data.results.length > 0) {
                    showResults(data);
                } else {
                    document.getElementById('noFaceSection').classList.remove('hidden');
                }
            } catch (err) {
                document.getElementById('loadingState').classList.add('hidden');
                alert('Error: ' + err.message);
            }
        }

        function showTooManyFacesError(message, faceCount) {
            const noFaceSection = document.getElementById('noFaceSection');
            noFaceSection.innerHTML = `
                <div class="glass-card rounded-2xl sm:rounded-3xl p-6 sm:p-8 text-center">
                    <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-2">Terlalu Banyak Wajah</h3>
                    <p class="text-purple-200 mb-4">${message}</p>
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <span class="text-4xl font-bold text-red-400">${faceCount}</span>
                        <span class="text-purple-300">wajah terdeteksi</span>
                    </div>
                    <p class="text-purple-300/70 text-sm">Pastikan hanya 1-2 orang yang terlihat di foto</p>
                </div>
            `;
            noFaceSection.classList.remove('hidden');
        }

        function showResults(data) {
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultImage').src = data.annotated_image;

            const detectionDetails = document.getElementById('detectionDetails');
            detectionDetails.innerHTML = '';

            data.results.forEach((result, idx) => {
                const confClass = result.confidence >= 0.7 ? 'conf-high' : result.confidence >= 0.5 ? 'conf-medium' : 'conf-low';

                const badgeColors = {
                    'light': 'from-yellow-400 to-amber-500 text-amber-900',
                    'mid-light': 'from-orange-400 to-orange-500',
                    'mid-dark': 'from-purple-400 to-purple-600',
                    'dark': 'from-indigo-500 to-purple-700'
                };

                const skinColors = {
                    'light': '#FFECD2', 'mid-light': '#E0C3A8',
                    'mid-dark': '#A67C52', 'dark': '#5D4037'
                };

                const rec = result.recommendation;

                // Generate color swatches dengan tooltip
                const goodColorsHtml = rec.good.map(c => `
                    <div class="group relative">
                        <div class="flex items-center gap-2 p-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-all cursor-pointer">
                            <div class="w-8 h-8 rounded-lg shadow-md border border-white/20" style="background: ${c.hex}"></div>
                            <div>
                                <p class="text-green-300 text-xs font-medium">${c.name}</p>
                                <p class="text-green-300/50 text-[10px]">${c.hex}</p>
                            </div>
                        </div>
                        <div class="absolute bottom-full left-0 mb-2 p-3 bg-slate-800 rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity z-10 w-64 pointer-events-none">
                            <p class="text-green-300 text-xs font-semibold mb-1">üí° Mengapa cocok?</p>
                            <p class="text-slate-300 text-xs">${c.reason}</p>
                        </div>
                    </div>
                `).join('');

                const avoidColorsHtml = rec.avoid.map(c => `
                    <div class="group relative">
                        <div class="flex items-center gap-2 p-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-all cursor-pointer">
                            <div class="w-8 h-8 rounded-lg shadow-md border border-white/20 relative" style="background: ${c.hex}">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-full h-0.5 bg-red-500 rotate-45"></div>
                                </div>
                            </div>
                            <div>
                                <p class="text-red-300 text-xs font-medium">${c.name}</p>
                                <p class="text-red-300/50 text-[10px]">${c.hex}</p>
                            </div>
                        </div>
                        <div class="absolute bottom-full left-0 mb-2 p-3 bg-slate-800 rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity z-10 w-64 pointer-events-none">
                            <p class="text-red-300 text-xs font-semibold mb-1">‚ö†Ô∏è Mengapa hindari?</p>
                            <p class="text-slate-300 text-xs">${c.reason}</p>
                        </div>
                    </div>
                `).join('');

                const html = `
                    <div class="glass-card rounded-2xl p-6 space-y-5">
                        <!-- Header with skin tone -->
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 rounded-full border-4 border-white/20 shadow-lg" style="background: ${result.skin_color?.hex || skinColors[result.skin_tone]}"></div>
                            <div>
                                <span class="px-5 py-2 rounded-full bg-gradient-to-r ${badgeColors[result.skin_tone]} font-bold text-white text-lg inline-block shadow-lg">
                                    ${result.skin_tone.toUpperCase()}
                                </span>
                                <p class="text-purple-300/70 text-sm mt-1">Face #${idx + 1} ‚Ä¢ Warna kulit: ${result.skin_color?.hex || 'N/A'}</p>
                            </div>
                        </div>
                        
                        <!-- Undertone & Season -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-3 rounded-xl bg-purple-500/10 border border-purple-500/20">
                                <p class="text-purple-300/50 text-xs">Undertone</p>
                                <p class="text-purple-200 text-sm font-semibold">${rec.undertone}</p>
                            </div>
                            <div class="p-3 rounded-xl bg-pink-500/10 border border-pink-500/20">
                                <p class="text-pink-300/50 text-xs">Season Type</p>
                                <p class="text-pink-200 text-sm font-semibold">${rec.season}</p>
                            </div>
                        </div>
                        
                        <!-- Validation Details (NEW) -->
                        ${result.validation ? `
                        <div class="p-4 rounded-xl ${result.validation.is_valid ? 'bg-green-500/10 border border-green-500/30' : 'bg-red-500/10 border border-red-500/30'}">
                            <div class="flex items-center gap-2 mb-3">
                                <span class="text-lg">${result.validation.is_valid ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                                <h4 class="${result.validation.is_valid ? 'text-green-300' : 'text-red-300'} font-semibold text-sm">
                                    Validation: ${result.validation.is_valid ? 'VALID' : 'PERHATIAN'}
                                </h4>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Skin Mask Preview -->
                                <div>
                                    <p class="text-slate-400 text-xs mb-2">üîç Skin Mask (Area Kulit Terdeteksi)</p>
                                    <img src="${result.skin_mask}" alt="Skin Mask" class="w-full rounded-lg border border-slate-600">
                                    <p class="text-slate-500 text-[10px] mt-1">Hijau = Area kulit yang terdeteksi</p>
                                </div>
                                
                                <!-- Validation Metrics -->
                                <div class="space-y-3">
                                    <!-- Brightness -->
                                    <div class="p-3 rounded-lg ${result.validation.brightness_ok ? 'bg-green-500/10' : 'bg-yellow-500/10'}">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-slate-300 text-xs">üí° Brightness</span>
                                            <span class="${result.validation.brightness_ok ? 'text-green-400' : 'text-yellow-400'} text-xs font-bold">
                                                ${result.validation.brightness_status}
                                            </span>
                                        </div>
                                        <p class="text-slate-500 text-[10px]">Nilai: ${result.validation.brightness_value} (ideal: 70-210)</p>
                                    </div>
                                    
                                    <!-- Skin Ratio -->
                                    <div class="p-3 rounded-lg ${result.validation.skin_ratio_ok ? 'bg-green-500/10' : 'bg-red-500/10'}">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-slate-300 text-xs">üë§ Skin Ratio</span>
                                            <span class="${result.validation.skin_ratio_ok ? 'text-green-400' : 'text-red-400'} text-xs font-bold">
                                                ${result.validation.skin_ratio_percent}%
                                            </span>
                                        </div>
                                        <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                                            <div class="h-full rounded-full transition-all ${result.validation.skin_ratio_ok ? 'bg-green-500' : 'bg-red-500'}" 
                                                 style="width: ${Math.min(100, result.validation.skin_ratio_percent)}%"></div>
                                        </div>
                                        <p class="text-slate-500 text-[10px] mt-1">Minimal 40% area harus kulit</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Description -->
                        <div class="p-4 rounded-xl bg-slate-800/50 border border-slate-700">
                            <p class="text-slate-300 text-sm">${rec.description}</p>
                        </div>
                        
                        <!-- Confidence -->
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-purple-200 text-sm">Confidence Level</span>
                                <span class="text-white font-bold">${(result.confidence * 100).toFixed(1)}%</span>
                            </div>
                            <div class="h-3 bg-slate-700 rounded-full overflow-hidden">
                                <div class="h-full ${confClass} rounded-full" style="width: ${result.confidence * 100}%"></div>
                            </div>
                        </div>
                        
                        <!-- Color Recommendations -->
                        <div>
                            <h4 class="text-green-400 font-semibold text-sm mb-3 flex items-center gap-2">
                                ‚úÖ Warna yang Cocok 
                                <span class="text-green-300/50 text-xs font-normal">(hover untuk lihat alasan)</span>
                            </h4>
                            <div class="grid grid-cols-2 gap-2">
                                ${goodColorsHtml}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-red-400 font-semibold text-sm mb-3 flex items-center gap-2">
                                üö´ Hindari
                                <span class="text-red-300/50 text-xs font-normal">(hover untuk lihat alasan)</span>
                            </h4>
                            <div class="grid grid-cols-2 gap-2">
                                ${avoidColorsHtml}
                            </div>
                        </div>
                        
                        <!-- Theory & Source -->
                        <div class="p-4 rounded-xl bg-blue-500/10 border border-blue-500/20">
                            <p class="text-blue-300 text-xs mb-2">üìö <strong>Dasar Teori:</strong></p>
                            <p class="text-blue-200/80 text-xs mb-3">${rec.theory}</p>
                            <p class="text-blue-300/50 text-[10px]">üìé Sumber: ${rec.source}</p>
                        </div>
                    </div>
                `;
                detectionDetails.innerHTML += html;

                // Setup Color Comparison for first face
                if (idx === 0) {
                    setupColorComparison(result.recommendation, result.skin_color);
                }
            });
        }

        // ===== COLOR COMPARISON FUNCTIONS =====
        let currentSkinColor = null;
        let allTryOnColors = [];
        let currentSelectedColor = null;

        function setupColorComparison(recommendation, skinColor) {
            const goodPalette = document.getElementById('goodColorPalette');
            const avoidPalette = document.getElementById('avoidColorPalette');

            // Store skin color
            currentSkinColor = skinColor;

            // Update skin color display
            if (skinColor) {
                document.getElementById('skinColorSwatch').style.background = skinColor.hex;
                document.getElementById('skinColorHex').textContent = skinColor.hex;
                document.getElementById('previewSkin').style.background = skinColor.hex;
            }

            // Combine good and avoid colors
            allTryOnColors = [
                ...recommendation.good.map(c => ({ ...c, type: 'good', rating: 5 })),
                ...recommendation.avoid.map(c => ({ ...c, type: 'avoid', rating: 2 }))
            ];

            // Create good color buttons
            if (goodPalette) {
                goodPalette.innerHTML = '';
                recommendation.good.forEach((color, idx) => {
                    const stars = color.stars || 5;
                    const score = color.score || 100;
                    const btn = createSimpleColorButton(color, 'good', idx, stars, score);
                    goodPalette.appendChild(btn);
                });
            }

            // Create avoid color buttons
            if (avoidPalette) {
                avoidPalette.innerHTML = '';
                recommendation.avoid.forEach((color, idx) => {
                    const stars = color.stars || 2;
                    const score = color.score || 30;
                    const btn = createSimpleColorButton(color, 'avoid', idx + recommendation.good.length, stars, score);
                    avoidPalette.appendChild(btn);
                });
            }

            // Auto-select first good color
            if (recommendation.good.length > 0) {
                const firstColor = recommendation.good[0];
                setTimeout(() => selectColorForComparison(firstColor, 'good', 0), 200);
            }
        }

        function createSimpleColorButton(color, type, index, rating, score) {
            const btn = document.createElement('button');
            btn.className = `tryOnColorBtn group flex flex-col items-center p-1.5 rounded-lg bg-slate-700/50 hover:bg-slate-600/50 transition-all border ${type === 'good' ? 'border-green-500/30 hover:border-green-400' : 'border-red-500/30 hover:border-red-400'}`;
            btn.onclick = () => selectTryOnColor(color, type, index, rating);
            btn.title = `${color.name} (${color.hex}) - Score: ${score || '--'}%`;

            // Color swatch
            const swatch = document.createElement('div');
            swatch.className = 'w-8 h-8 rounded-md shadow border border-white/10 relative';
            swatch.style.background = color.hex;

            // Add score badge
            if (score) {
                const badge = document.createElement('span');
                badge.className = `absolute -top-1 -right-1 text-[7px] px-1 rounded-full font-bold ${score >= 70 ? 'bg-green-500 text-white' : score >= 50 ? 'bg-yellow-500 text-black' : 'bg-red-500 text-white'}`;
                badge.textContent = score;
                swatch.appendChild(badge);
            }
            btn.appendChild(swatch);

            // Color name (short)
            const name = document.createElement('span');
            name.className = `text-[8px] ${type === 'good' ? 'text-green-300/70' : 'text-red-300/70'} truncate max-w-[50px] mt-1`;
            name.textContent = color.name.length > 8 ? color.name.substring(0, 8) + '..' : color.name;
            btn.appendChild(name);

            return btn;
        }

        function createEnhancedColorButton(color, type, index, rating) {
            const btn = document.createElement('button');
            btn.className = `tryOnColorBtn group relative flex flex-col items-center p-2 rounded-xl bg-slate-800/50 hover:bg-slate-700/50 transition-all transform hover:scale-105 border-2 ${type === 'good' ? 'border-green-500/30 hover:border-green-400' : 'border-red-500/30 hover:border-red-400'}`;
            btn.onclick = () => selectTryOnColor(color, type, index, rating);

            // Color swatch
            const swatch = document.createElement('div');
            swatch.className = 'w-10 h-10 rounded-lg shadow-lg border border-white/20 mb-1';
            swatch.style.background = color.hex;

            // Add X for avoid colors
            if (type === 'avoid') {
                swatch.innerHTML = '<div class="w-full h-full flex items-center justify-center"><div class="w-8 h-0.5 bg-red-500 rotate-45 absolute"></div><div class="w-8 h-0.5 bg-red-500 -rotate-45 absolute"></div></div>';
                swatch.className += ' relative';
            }
            btn.appendChild(swatch);

            // Color name
            const name = document.createElement('span');
            name.className = `text-[10px] ${type === 'good' ? 'text-green-300' : 'text-red-300'} truncate max-w-[60px]`;
            name.textContent = color.name;
            btn.appendChild(name);

            // Star rating
            const stars = document.createElement('div');
            stars.className = 'flex gap-0.5';
            for (let i = 0; i < 5; i++) {
                const star = document.createElement('span');
                star.className = 'text-[8px]';
                star.textContent = i < rating ? '‚≠ê' : '‚òÜ';
                stars.appendChild(star);
            }
            btn.appendChild(stars);

            return btn;
        }

        function selectClothingType(type) {
            currentClothingType = type;

            // Update button styles - find the clicked button by matching text content
            document.querySelectorAll('.clothing-type-btn').forEach(btn => {
                btn.classList.remove('bg-purple-600', 'text-white');
                btn.classList.add('bg-slate-700', 'text-slate-300');

                // Check if this button matches the type
                const btnText = btn.textContent.toLowerCase();
                if ((type === 'tshirt' && btnText.includes('t-shirt')) ||
                    (type === 'polo' && btnText.includes('polo')) ||
                    (type === 'shirt' && btnText.includes('kemeja')) ||
                    (type === 'dress' && btnText.includes('dress'))) {
                    btn.classList.remove('bg-slate-700', 'text-slate-300');
                    btn.classList.add('bg-purple-600', 'text-white');
                }
            });

            // Update SVG path
            const clothingPath = document.getElementById('clothingPath');
            if (clothingPath) {
                clothingPath.setAttribute('d', clothingPaths[type]);
            }

            // Show/hide buttons for polo/shirt
            const buttons = document.getElementById('buttons');
            if (buttons) {
                if (type === 'polo' || type === 'shirt') {
                    buttons.classList.remove('hidden');
                } else {
                    buttons.classList.add('hidden');
                }
            }

            // Update neckline
            const neckline = document.getElementById('neckline');
            if (neckline) {
                if (type === 'dress') {
                    neckline.setAttribute('rx', '18');
                    neckline.setAttribute('ry', '8');
                } else {
                    neckline.setAttribute('rx', '22');
                    neckline.setAttribute('ry', '10');
                }
            }
        }

        function selectColorForComparison(color, type, index) {
            const actualScore = color.score || (type === 'good' ? 80 : 30);
            currentSelectedColor = { ...color, type, score: actualScore };

            // Update clothing color display
            document.getElementById('clothingColorSwatch').style.background = color.hex;
            document.getElementById('clothingColorName').textContent = color.name;
            document.getElementById('clothingColorHex').textContent = color.hex;
            document.getElementById('previewClothing').style.background = color.hex;

            // Update custom color picker
            const picker = document.getElementById('customColorPicker');
            if (picker) picker.value = color.hex;

            // Highlight selected button
            document.querySelectorAll('.tryOnColorBtn').forEach((btn) => {
                btn.classList.remove('ring-2', 'ring-purple-400', 'scale-110', 'bg-purple-900/50');
            });
            const buttons = document.querySelectorAll('.tryOnColorBtn');
            if (buttons[index]) {
                buttons[index].classList.add('ring-2', 'ring-purple-400', 'scale-110', 'bg-purple-900/50');
            }

            // Calculate and update comparison metrics
            updateColorComparison(color, type, actualScore);
        }

        function updateColorComparison(color, type, score) {
            const contrastScore = color.score_details?.contrast || (type === 'good' ? 75 : 40);
            const harmonyScore = color.score_details?.harmony || (type === 'good' ? 80 : 35);
            const overallScore = score;

            // Update contrast bar
            document.getElementById('contrastScore').textContent = contrastScore + '%';
            document.getElementById('contrastBar').style.width = contrastScore + '%';

            // Update harmony bar
            document.getElementById('harmonyScore').textContent = harmonyScore + '%';
            document.getElementById('harmonyBar').style.width = harmonyScore + '%';

            // Update overall score
            document.getElementById('overallScore').textContent = overallScore + '%';
            const starCount = Math.round(overallScore / 20);
            document.getElementById('overallStars').textContent = '‚≠ê'.repeat(starCount) + '‚òÜ'.repeat(5 - starCount);

            // Update harmony indicator
            const harmonyIndicator = document.getElementById('harmonyIndicator');
            if (overallScore >= 70) {
                harmonyIndicator.textContent = '‚úì Harmonis';
                harmonyIndicator.className = 'mt-2 px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-400 transition-all';
            } else if (overallScore >= 50) {
                harmonyIndicator.textContent = '~ Netral';
                harmonyIndicator.className = 'mt-2 px-3 py-1 rounded-full text-xs font-bold bg-yellow-500/20 text-yellow-400 transition-all';
            } else {
                harmonyIndicator.textContent = '‚úó Kurang Cocok';
                harmonyIndicator.className = 'mt-2 px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-400 transition-all';
            }

            // Update skin effect card
            updateSkinEffectCard(type, overallScore, color.reason);
        }

        function updateSkinEffectCard(type, score, reason) {
            const card = document.getElementById('skinEffectCard');
            const icon = document.getElementById('skinEffectIcon');
            const title = document.getElementById('skinEffectTitle');
            const desc = document.getElementById('skinEffectDesc');

            if (score >= 70) {
                card.className = 'p-5 rounded-2xl bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-500/30 transition-all';
                icon.textContent = '‚ú®';
                title.className = 'text-lg font-bold text-green-300';
                title.textContent = 'Kulit Terlihat Cerah';
                desc.className = 'text-sm text-green-200/70';
                desc.textContent = reason || 'Warna ini menonjolkan kecerahan kulit Anda';
            } else if (score >= 50) {
                card.className = 'p-5 rounded-2xl bg-gradient-to-r from-yellow-900/30 to-amber-900/30 border border-yellow-500/30 transition-all';
                icon.textContent = 'üòê';
                title.className = 'text-lg font-bold text-yellow-300';
                title.textContent = 'Kulit Terlihat Netral';
                desc.className = 'text-sm text-yellow-200/70';
                desc.textContent = reason || 'Warna ini tidak terlalu mempengaruhi tampilan kulit';
            } else {
                card.className = 'p-5 rounded-2xl bg-gradient-to-r from-red-900/30 to-orange-900/30 border border-red-500/30 transition-all';
                icon.textContent = 'üòï';
                title.className = 'text-lg font-bold text-red-300';
                title.textContent = 'Kulit Terlihat Kusam';
                desc.className = 'text-sm text-red-200/70';
                desc.textContent = reason || 'Warna ini dapat membuat kulit terlihat kusam atau tidak sehat';
            }
        }

        // Keep old function name for compatibility
        function selectTryOnColor(color, type, index, rating) {
            selectColorForComparison(color, type, index);
        }

        function updateClothingColor(hexColor) {
            // Adjust color based on shade slider
            const adjustedColor = adjustColorBrightness(hexColor, currentShadeValue);
            const darkerColor = adjustColorBrightness(hexColor, Math.max(0, currentShadeValue - 20));

            // Update gradient stops
            document.getElementById('gradientStop1').style.stopColor = adjustedColor;
            document.getElementById('gradientStop2').style.stopColor = darkerColor;
        }

        function adjustColorShade(value) {
            currentShadeValue = parseInt(value);
            if (currentSelectedColor) {
                renderColorOverlay(currentSelectedColor.hex);
            }
        }

        function adjustColorBrightness(hex, percent) {
            // Convert hex to RGB
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);

            // Adjust brightness (percent: 0=dark, 50=normal, 100=light)
            const factor = (percent - 50) / 100;

            if (factor > 0) {
                // Lighten
                r = Math.min(255, r + (255 - r) * factor);
                g = Math.min(255, g + (255 - g) * factor);
                b = Math.min(255, b + (255 - b) * factor);
            } else {
                // Darken
                r = Math.max(0, r + r * factor);
                g = Math.max(0, g + g * factor);
                b = Math.max(0, b + b * factor);
            }

            return `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
        }

        function updateCompatibilityRating(type, rating, reason) {
            const score = document.getElementById('compatibilityScore');
            const bar = document.getElementById('compatibilityBar');
            const text = document.getElementById('compatibilityText');

            // Use actual score if available
            const percentage = actualScore || (rating / 5) * 100;

            // Display score as stars and percentage
            score.textContent = '‚≠ê'.repeat(Math.round(rating)) + '‚òÜ'.repeat(5 - Math.round(rating)) + ' ' + percentage + '%';

            // Animate bar
            bar.style.width = percentage + '%';

            // Update bar color based on percentage
            if (percentage >= 70) {
                bar.style.background = 'linear-gradient(90deg, #22c55e, #16a34a)';
            } else if (percentage >= 50) {
                bar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
            }

            // Build detailed text with score breakdown
            let detailText = '';
            if (scoreDetails) {
                detailText = ` (Undertone: ${scoreDetails.undertone_match}%, Kontras: ${scoreDetails.contrast}%, Harmoni: ${scoreDetails.harmony}%)`;
            }

            // Update text
            if (type === 'good') {
                text.textContent = '‚úÖ ' + reason + detailText;
                text.className = 'text-green-300 text-xs mt-2';
            } else if (type === 'avoid') {
                text.textContent = '‚ö†Ô∏è ' + reason + detailText;
                text.className = 'text-red-300 text-xs mt-2';
            } else {
                text.textContent = 'üé® ' + reason + detailText;
                text.className = 'text-purple-300 text-xs mt-2';
            }
        }

        function updateCompatibilityBadge(type, score) {
            const badge = document.getElementById('compatibilityBadge');
            if (!badge) return;

            if (score >= 70) {
                badge.textContent = '‚úì ' + score + '%';
                badge.className = 'px-2 py-0.5 rounded-full text-[10px] font-bold bg-green-500/20 text-green-400 border border-green-500/50';
            } else if (score >= 50) {
                badge.textContent = '~ ' + score + '%';
                badge.className = 'px-2 py-0.5 rounded-full text-[10px] font-bold bg-yellow-500/20 text-yellow-400 border border-yellow-500/50';
            } else {
                badge.textContent = '‚úó ' + score + '%';
                badge.className = 'px-2 py-0.5 rounded-full text-[10px] font-bold bg-red-500/20 text-red-400 border border-red-500/50';
            }
        }

        // ===== NEW FEATURES =====
        let currentSaturation = 50;
        let isCompareMode = false;
        let currentRecommendation = null;

        function applyCustomColor(hexColor) {
            const customColor = {
                name: 'Custom',
                hex: hexColor,
                type: 'custom',
                score: 60,
                reason: 'Warna custom - coba lihat apakah cocok dengan skin tone Anda'
            };
            selectColorForComparison(customColor, 'custom', -1);
        }

        function renderColorOverlay(hexColor) {
            const canvas = document.getElementById('tryOnCanvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            if (!currentTryOnImage) return;

            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function () {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                const overlayHeight = img.height * 0.45;
                const overlayY = img.height - overlayHeight;

                const adjustedColor = adjustColorBrightness(hexColor, currentShadeValue);

                const gradient = ctx.createLinearGradient(0, overlayY - 50, 0, img.height);
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(0.15, adjustedColor.replace('rgb', 'rgba').replace(')', ',0.3)'));
                gradient.addColorStop(0.4, adjustedColor.replace('rgb', 'rgba').replace(')', ',0.7)'));
                gradient.addColorStop(1, adjustedColor.replace('rgb', 'rgba').replace(')', ',0.85)'));

                ctx.fillStyle = gradient;
                ctx.fillRect(0, overlayY - 50, img.width, overlayHeight + 50);
            };
            img.src = currentTryOnImage;
        }

        function adjustSaturation(value) {
            currentSaturation = parseInt(value);
            if (currentSelectedColor) {
                renderColorOverlay(currentSelectedColor.hex);
            }
        }

        function toggleCompareMode() {
            isCompareMode = document.getElementById('compareMode').checked;
            const compareCard = document.getElementById('compareCard');

            if (isCompareMode) {
                compareCard.classList.remove('hidden');
            } else {
                compareCard.classList.add('hidden');
            }
        }

        function openFullscreen() {
            const modal = document.getElementById('fullscreenModal');
            const fullCanvas = document.getElementById('fullscreenCanvas');
            const label = document.getElementById('fullscreenLabel');
            const srcCanvas = document.getElementById('tryOnCanvas');

            if (!srcCanvas || !modal) return;

            modal.classList.remove('hidden');

            fullCanvas.width = srcCanvas.width;
            fullCanvas.height = srcCanvas.height;
            const ctx = fullCanvas.getContext('2d');
            ctx.drawImage(srcCanvas, 0, 0);

            label.textContent = currentSelectedColor ?
                'Preview dengan ' + currentSelectedColor.name : 'Preview';
        }

        function closeFullscreen() {
            const modal = document.getElementById('fullscreenModal');
            if (modal) modal.classList.add('hidden');
        }

        function downloadResult() {
            const canvas = document.getElementById('tryOnCanvas');
            if (!canvas) return;

            const link = document.createElement('a');
            link.download = 'skin-tone-preview-' + (currentSelectedColor?.name || 'custom') + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function generateOutfitPalette() {
            if (currentSelectedColor) {
                generatePaletteFromColor(currentSelectedColor.hex);
            } else if (allTryOnColors.length > 0) {
                generatePaletteFromColor(allTryOnColors[0].hex);
            }
        }

        function generatePaletteFromColor(baseHex) {
            const tops = baseHex;
            const bottoms = generateComplementary(baseHex, 180);
            const shoes = generateComplementary(baseHex, 30);
            const accessory = generateComplementary(baseHex, 60);

            const el1 = document.getElementById('paletteTops');
            const el2 = document.getElementById('paletteBottoms');
            const el3 = document.getElementById('paletteShoes');
            const el4 = document.getElementById('paletteAccessory');

            if (el1) el1.style.background = tops;
            if (el2) el2.style.background = bottoms;
            if (el3) el3.style.background = shoes;
            if (el4) el4.style.background = accessory;
        }

        function generateComplementary(hex, hueShift) {
            let r = parseInt(hex.slice(1, 3), 16) / 255;
            let g = parseInt(hex.slice(3, 5), 16) / 255;
            let b = parseInt(hex.slice(5, 7), 16) / 255;

            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }

            h = (h + hueShift / 360) % 1;

            function hue2rgb(p, q, t) {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            }

            let q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            let p = 2 * l - q;
            r = Math.round(hue2rgb(p, q, h + 1 / 3) * 255);
            g = Math.round(hue2rgb(p, q, h) * 255);
            b = Math.round(hue2rgb(p, q, h - 1 / 3) * 255);

            return 'rgb(' + r + ', ' + g + ', ' + b + ')';
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeFullscreen();
        });
    </script>
</body>

</html>